ALTER TABLE transactions
ALTER
COLUMN amount TYPE DECIMAL USING (amount::DECIMAL);

ALTER TABLE accounts
ALTER
COLUMN balance TYPE DECIMAL USING (balance::DECIMAL);

ALTER TABLE users
ALTER
COLUMN email TYPE VARCHAR(255) USING (email::VARCHAR(255));

ALTER TABLE accounts
ALTER
COLUMN iban TYPE VARCHAR(255) USING (iban::VARCHAR(255));

ALTER TABLE accounts
DROP
COLUMN id;

ALTER TABLE accounts
DROP
COLUMN user_id;

ALTER TABLE accounts
    ADD id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY;

ALTER TABLE transactions
DROP
COLUMN id;

ALTER TABLE transactions
DROP
COLUMN source_account_id;

ALTER TABLE transactions
DROP
COLUMN target_account_id;

ALTER TABLE transactions
    ADD id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY;

ALTER TABLE users
DROP
COLUMN id;

ALTER TABLE users
    ADD id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY;

ALTER TABLE users
ALTER
COLUMN name TYPE VARCHAR(255) USING (name::VARCHAR(255));

ALTER TABLE users
ALTER
COLUMN password_hash TYPE VARCHAR(255) USING (password_hash::VARCHAR(255));

ALTER TABLE transactions
    ADD source_account_id BIGINT;

ALTER TABLE transactions
    ADD CONSTRAINT FK_TRANSACTIONS_ON_SOURCE_ACCOUNT FOREIGN KEY (source_account_id) REFERENCES accounts (id);

ALTER TABLE transactions
    ALTER COLUMN source_account_id DROP NOT NULL;

ALTER TABLE users
ALTER
COLUMN surname TYPE VARCHAR(255) USING (surname::VARCHAR(255));

ALTER TABLE transactions
    ADD target_account_id BIGINT;

ALTER TABLE transactions
    ADD CONSTRAINT FK_TRANSACTIONS_ON_TARGET_ACCOUNT FOREIGN KEY (target_account_id) REFERENCES accounts (id);

ALTER TABLE transactions
    ALTER COLUMN timestamp SET NOT NULL;

ALTER TABLE transactions
ALTER
COLUMN type TYPE VARCHAR(255) USING (type::VARCHAR(255));

ALTER TABLE transactions
    ALTER COLUMN type DROP NOT NULL;

ALTER TABLE accounts
    ADD user_id BIGINT;

ALTER TABLE accounts
    ADD CONSTRAINT FK_ACCOUNTS_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

ALTER TABLE accounts
    ALTER COLUMN user_id DROP NOT NULL;